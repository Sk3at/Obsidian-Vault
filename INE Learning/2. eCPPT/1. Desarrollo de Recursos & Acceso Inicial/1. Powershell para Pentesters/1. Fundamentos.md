¿Que es Powershell?
Powershell es un poderoso interprete de linea de comandos y esta orientado al scripting, puede ser encontrado en la mayoria de los sistemas operativos Windows.
Powershell es utilizado tipicamente por administradores ya que provee una gran funcionalidad y flexibilidad para administrar sistemas Windows y automatizar tareas, lo que lo hace una excelente herramienta para el proceso de pentesting.
Como esta ligeramente integrado con el .NET framework contiene acceso conveniente al API de .NET asi como al component object model (COM) y al Windows management instrumentation (WMI), lo que nos da un plus al momento de establecer persistencia asi como tambien al recopilar informacion en un objetivo.
La mayor parte del tiempo trabajaremos con scripts identificado con la extencion .ps1 o por aquellos que son conocidos como cmdlets (comandos nativos de powershell).

¿Por que Powershell?
El uso de powershell nos permite tomar ventaja utilizando herramientas que esta dentro del sistema Operativo una vez que obtuvimos acceso al mismo.
Algunas de las ventajas son:
- Muchas organizaciones no rastrean/monitorean la actividad de powershell.
- Podemos utilizar powershell para correr, descargar o ejecutar codigo dentro del proceso de memoria del ejecutable powershell, ayudandonos a evadir soluciones de seguridad del endpoint.
- Podemos utilizarlo para interactuar con .NET y otras APIs de Windows.
- Podemos utilizar funciones DLL desde dentro de powershell.
- Podemos ejecutar aplicaciones que no se encuentren en la whitelist.
- Existen numerosas herramientas disponibles para pentesting (https://github.com/PowerShellMafia/PowerSploit)

Powershell CLI
La CLI de powershell nos provee con acceso a cmdlets, modulos, funciones y nos prevee un metodo para crear tareas, funciones, variables y mas de forma directa.
En la mayoria de los casos se puede acceder al CLI tipeando en la barra de busqueda "powershell".
![](../../../../Pasted%20image%2020240328155659.png)
En ocaciones donde el acceso directo a powershell no se encuentre disponible podemos encontrarlo en:
- 64bits: C:\\windows\\system32\\WindowsPowerShell
- 32bits: C:\\windows\\SysWOW64\\WindowsPowerShell
![](../../../../Pasted%20image%2020240328160147.png)
Podemos chequear si el proceso de powershell que ejecutamos es de 64bits con el comando Environment::Is64BitProcess
El cual retornara True si es de 64.
![](../../../../Pasted%20image%2020240328160454.png)
Cuando sea posible debemos ejecutar powershell como administrador ya que sino tendremos privilegios minimos de usuario.

USO BASICO
Podemos ver la ayuda en poweshell con el comando /?, -Help o -?
![](../../../../Pasted%20image%2020240328202808.png)
Los siguientes son los comandos que mas utilizaremos para nuestros propositos de pentest.
La powershell tiene una politica de ejecucion que determina que scripts pueden ser utilizados, esta politica puede ser desabilitada con -ExecutionPolicy Bypass o -ExecutionPolicy Unrestricted utilizadas como argumento en algun script que queramos utilizar.
![](../../../../Pasted%20image%2020240328203047.png)
Tambien existe la -WindowsStyle Hidden que nos permite si estuvieramos en un reverse shell ejecutar algun comando o script de powershell sin que se abra el powershell en el objetivo (lo cual es importante si hay algun usuario utilizando la maquina en ese momento).
![](../../../../Pasted%20image%2020240328203238.png)
Con el parametro -Command podemos especificar que powershell corra algun comando o ejecute un script block (una secuencia de scripts).
![](../../../../Pasted%20image%2020240328203415.png)
Podemos realizar un downgrade de la version de powershell con el parametro -Version.
![](../../../../Pasted%20image%2020240328203544.png)
Muchos de los parametros pueden ser abreviados:
![](../../../../Pasted%20image%2020240328203619.png)
