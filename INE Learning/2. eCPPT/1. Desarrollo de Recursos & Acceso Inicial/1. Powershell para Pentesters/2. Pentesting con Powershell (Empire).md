Powershell-Empire (Aka Empire) es un marco de trabajo de powershell para explotacion/post-explotacion construido sobre comunicaciones seguras encriptadas y con una arquitectura flexible.
Empire implementa la habilidad de correr agentes de powershell sin la necesidad de powershell.exe, da la posibilidad de lanzar modulos de post explotacion desde keyloggers hasta mimikatz, y contiene comunicaciones adaptables para evadir detecciones de red, todo junto dentro del marco de trabajo enfocado en la usabilidad.
Recientemente fue actualizado y ahora es parte del soporte oficial mantenido por Kali.
En ciertos puntos es similar al framework de Metasploit, con la principal diferencia que Empire se utiliza para la explotacion y post explotacion para sistemas Windows especialmente.
Es un marco avanzado y se ve como un servidor C2 (command and control).
Podemos encontrar la documentacion de Empire en el siguiente link: https://bc-security.gitbook.io/empire-wiki

LABORATORIO
Se nos da la tarea por una organizacion de realizar un penetration test. Se supone que la maquina que esta frente a la conexion de internet se encuentra en el dominio demo.ine.local y se nos informa que existe otra maquina en el dominio fileserver.ine.local la cual no es accesible de forma directa.
Debemos realizar la explotacion remota en el sistema vulnerable para ganar acceso a ambas maquinas y obtener la flag.

SOLUCION
Una vez dentro de nuestra VM abrimos la terminal y revisamos si se encuentra configurado el dominio demo.ine.local en el archivo /etc/hosts
![](../../../../Pasted%20image%2020240403191541.png)
Ahoa que sabemos la direccion IP del mismo procedemos a lanzarle un ping para verificar que responde solicitudes ICMP. Para ello creamos una variable de entorno llamada target con el valor de la direccion IP de la victima y luego realizamos un ping utilizando la variable.
![](../../../../Pasted%20image%2020240403191924.png)
Como se observa, el TTL de respuesta del ICMP es de 125 lo que corresponderia a una maquina Windows. El siguiente paso es realizar un escaneo de puertos para verificar cuales son los puertos abiertos en nuestra maquina victima.
![](../../../../Pasted%20image%2020240403192232.png)
Con este comando estamos diciendo que queremos realizar un escaneo en los 65mil puertos, verificar unicamente los que se encuentren abiertos y luego utilizamos algunas opciones para que la verificacion sea rapida y lo menos intrusiva posible.
- -sS SYN SCAN
- -n NO DNS
- -Pn NO PING
- --min-rate 5000 NO MENOS DE 5000 PQTS POR SEGUNDO
En tan solo 12 segundos obtenemos la informacion de los puertos abiertos en la maquina victima ![](../../../../Pasted%20image%2020240403192545.png)
Ahora debemos realizar un segundo escaneo para intentar ver que servicios y versiones se ejecutan en estos puertos abiertos.
![](../../../../Pasted%20image%2020240403193023.png)
![](../../../../Pasted%20image%2020240403193006.png)
Lo que vemos es que tenemos en ejecucion SMB, RDP y dos servidores web en los puertos superiores. Vamos a verificar primero los servidores web en busqueda de algo que nos sea interesante.
![](../../../../Pasted%20image%2020240403193600.png)
Al realizar un curl al puerto 4983 vemos un mensaje de lo que parecen ser las credenciales de SMB del administrador. Por lo que podemos intentar conectarnos con estas credenciales por medio de psexec.
